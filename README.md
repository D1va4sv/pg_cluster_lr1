# **Описание**
## **Архитектура**

Проект состоит из трёх виртуальных машин на базе операционной системы Kali Linux:

- Master;
- Replica;
- Arbiter.

На всех виртуальных машинах установлен PostgreSQL 16 версии.

На виртуальных машинах Master и Replica настроена синхронная репликация PostgreSQL, по принципу Master->Replica.

На каждой из трёх виртуальных машин работают программы-агенты, написанные на bash.

## **Принцип работы программ-агентов**
**Master**

На ВМ Master работает программа-агент, которая каждые 30 секунд (это время может варьироваться в зависимости от конкретных условий) проверяет доступность Arbiter с помощью утилиты netcat и доступность Replica с помощью pg_isready.

В случае, если у Master теряется связь с Arbiter или Replica, он не предпринимает никаких действий и работает в штатном режиме.

В случае же потери связи и с Arbiter и с Replica, программа-агент выполняет команду *systemctl stop postgresql*.

**Replica**

На ВМ Replica работает программа-агент, которая каждые 30 секунд (это время может варьироваться в зависимости от конкретных условий) проверяет доступность Arbiter с помощью утилиты netcat и доступность Master с помощью pg_isready. Помимо этого, в программе-агент реализована функция, позволяющая обращаться к Arbiter и узнавать у него о доступности Master.

Replica делает *promote* только в том случае, если и у нее и у Arbiter теряется связь с Master, в иных случаях, не предпринимает никаких действий.

**Arbiter**

На ВМ Arbiter работает программа-агент, которая проверяет доступность Replica с помощью pg_isready и доступность Master с помощью утилиты netcat. Проверка Master сопровождается выводом статуса его работы, который потом запрашивает Replica.

**Логироание и cron**

Программа-агент, работающая на Arbiter запускается при старте системы и функционирует как непрерывный процесс.

Программы-агенты, работающие на Master и Replica, стартуют раз в 30 секунд при помощи утилиты *cron*.


